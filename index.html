<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Tu Empresa — Importación y Exportación de Coches Premium</title>
  <meta name="description" content="Importamos y exportamos coches premium a medida desde Europa y EE.UU. Inspección, logística, matriculación y garantía. Pide presupuesto sin compromiso.">
  <meta name="robots" content="index,follow">

  <!-- Canonical & Social -->
  <link rel="canonical" href="https://web-coches-rho.vercel.app/">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Tu Empresa">
  <meta property="og:title" content="Tu Empresa — Coches Premium Importados">
  <meta property="og:description" content="Vehículos verificados, importación rápida y garantía europea. Solicita tu coche a medida.">
  <meta property="og:image" content="https://web-coches-rho.vercel.app/og-image.jpg">
  <meta property="og:url" content="https://web-coches-rho.vercel.app/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Tu Empresa — Coches Premium Importados">
  <meta name="twitter:description" content="Vehículos verificados, importación rápida y garantía europea. Solicita tu coche a medida.">
  <meta name="twitter:image" content="https://web-coches-rho.vercel.app/og-image.jpg">

  <!-- Favicons / PWA -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#0f172a">

  <!-- JSON-LD AutoDealer -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "AutoDealer",
    "name": "Tu Empresa",
    "url": "https://web-coches-rho.vercel.app/",
    "areaServed": "España",
    "logo": "https://web-coches-rho.vercel.app/logo.png",
    "telephone": "+34 600 000 000",
    "sameAs": ["https://wa.me/34600000000"]
  }
  </script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#6366F1; --primary-dark:#4F46E5;
      --bg:#111827; --text:#F9FAFB; --muted:#9CA3AF;
      --card:#1F2937; --border:#374151; --shadow:0 8px 24px rgba(0,0,0,.35);
      --nav-h:64px; --nav-bg:#0f172a; --nav-border:rgba(255,255,255,.06);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    html,body{overflow-x:hidden}
    body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:var(--text);line-height:1.6;-webkit-tap-highlight-color:transparent}
    a{color:inherit;text-decoration:none}

    /* Header + Drawer (cierra solo con la X) */
    .site-header{position:sticky;top:0;z-index:50;background:var(--nav-bg);border-bottom:1px solid var(--nav-border);backdrop-filter:blur(8px) saturate(120%)}
    .nav-wrap{max-width:1200px;margin:0 auto;padding:12px 16px;height:var(--nav-h);display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{color:#fff;font-weight:800;letter-spacing:.2px;font-size:clamp(1.05rem,2vw,1.2rem)}
    .nav-desktop{display:none;gap:16px;align-items:center}
    .nav-desktop a{color:rgba(249,250,251,.92);font-weight:600;padding:8px 10px;border-radius:10px;transition:background .2s,color .2s}
    .nav-desktop a:hover{color:#fff;background:rgba(255,255,255,.06)}
    .nav-toggle{width:44px;height:44px;border-radius:12px;border:1px solid var(--nav-border);background:transparent;cursor:pointer;display:grid;place-items:center;gap:4px;transition:background .2s,border .2s}
    .nav-toggle:hover{background:rgba(255,255,255,.04)}
    .nav-toggle .bar{width:20px;height:2px;background:#e5e7eb;display:block;border-radius:2px;transition:transform .25s ease, opacity .25s ease}
    .nav-toggle[aria-expanded="true"] .bar:nth-child(1){transform:translateY(6px) rotate(45deg)}
    .nav-toggle[aria-expanded="true"] .bar:nth-child(2){opacity:0}
    .nav-toggle[aria-expanded="true"] .bar:nth-child(3){transform:translateY(-6px) rotate(-45deg)}
    @media (min-width:900px){.nav-toggle{display:none}.nav-desktop{display:flex}}

    .drawer{position:fixed;inset:0;display:grid;grid-template-columns:1fr;pointer-events:none;z-index:60}
    .drawer-backdrop{display:none}
    .drawer-inner{
      align-self:start;justify-self:end;
      width:clamp(320px,78vw,560px);
      height:100vh;height:100svh;height:100dvh;
      background:#0b1220;border-left:1px solid var(--nav-border);
      box-shadow:-24px 0 48px rgba(0,0,0,.6);
      transform:translateX(100%);transition:transform .28s ease;
      display:flex;flex-direction:column;overflow:auto;-webkit-overflow-scrolling:touch;
      padding:18px;padding-top:calc(16px + env(safe-area-inset-top,0px));
    }
    @media (min-width:600px) and (max-width:899px){.drawer-inner{width:min(88vw,560px)}}
    .drawer.open{pointer-events:auto}
    .drawer.open .drawer-inner{transform:translateX(0)}
    body.nav-open{overflow:hidden;touch-action:none;overscroll-behavior:contain}
    @media (min-width:900px){ #mobile-drawer{display:none} }
    .drawer-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    .drawer-title{color:#fff;font-weight:800;letter-spacing:.2px}
    .drawer-close{width:40px;height:40px;border-radius:12px;border:1px solid var(--nav-border);background:#111827;color:#e5e7eb;cursor:pointer;display:flex;align-items:center;justify-content:center}

    .drawer-nav{display:flex;flex-direction:column;gap:12px;padding:6px 0}
    .drawer-link{padding:12px 14px;border-radius:12px;color:var(--text);font-weight:600;border:1px solid transparent}
    .drawer-link:hover{background:rgba(255,255,255,.06);border-color:var(--nav-border);color:#fff}

    /* Buttons & Sections */
    .btn{display:inline-block;padding:12px 22px;border-radius:999px;font-weight:600;transition:.2s}
    .btn.primary{background:var(--primary);color:#fff;box-shadow:0 6px 18px rgba(99,102,241,.25)}
    .btn.primary:hover{background:var(--primary-dark)}
    section{max-width:1200px;margin:0 auto;padding:80px 24px}
    h1,h2{margin-bottom:16px;font-weight:700}
    h1{font-size:2.5rem;line-height:1.2}
    h2{font-size:1.8rem;text-align:center;color:#fff}
    p{margin-bottom:12px;color:rgba(249,250,251,.9)}

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:40px;align-items:center}
    .hero img{width:100%;border-radius:16px;box-shadow:var(--shadow);display:block}
    @media(max-width:900px){.hero{grid-template-columns:1fr;text-align:center}}

    /* Cards */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px;margin-top:40px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 4px 16px rgba(0,0,0,.35);transition:.2s}
    .card:hover{transform:translateY(-4px);box-shadow:0 10px 28px rgba(0,0,0,.45)}
    .card img{width:100%;border-radius:12px;margin-bottom:12px;display:block;aspect-ratio:16/9;object-fit:cover}
    .card span{color:var(--muted)}

    /* Form */
    form{background:var(--card);padding:32px;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.35);border:1px solid var(--border);max-width:600px;margin:40px auto 0}
    label{font-weight:600;display:block;margin-top:10px;color:#E5E7EB}
    input,textarea{width:100%;padding:14px;margin:6px 0 14px;background:#0B1220;border:1px solid var(--border);color:#fff;border-radius:12px;font-size:1rem;font-family:inherit;transition:border .15s, box-shadow .15s}
    input::placeholder, textarea::placeholder{color:var(--muted)}
    input:focus,textarea:focus{border-color:var(--primary);outline:none;box-shadow:0 0 0 2px rgba(99,102,241,.35)}
    button{background:var(--primary);color:#fff;border:none;padding:14px 24px;border-radius:999px;font-weight:600;cursor:pointer;transition:.2s;box-shadow:0 6px 18px rgba(99,102,241,.25)}
    button:hover{background:var(--primary-dark)}
    #form-status{color:var(--muted)}

    /* Footer */
    footer{background:#0B1220;border-top:1px solid rgba(255,255,255,.06);text-align:center;padding:24px;margin-top:40px;font-size:.9rem;color:var(--muted)}

    /* FAB móvil */
    .fab{position:fixed;right:16px;bottom:calc(16px + env(safe-area-inset-bottom,0px));z-index:40;display:none;gap:12px;align-items:center}
    .fab a{display:flex;align-items:center;gap:8px;background:var(--primary);color:#fff;padding:12px 16px;border-radius:999px;font-weight:700;box-shadow:0 8px 24px rgba(99,102,241,.35)}
    .fab a.secondary{background:#10B981}
    .fab svg{width:18px;height:18px;display:block}
    @media (max-width: 900px){.fab{display:flex} body{padding-bottom:76px}}
  </style>

  <!-- Utils (defer) -->
  <script src="js/utils.js" defer></script>
</head>
<body>

  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="nav-wrap">
      <a class="brand" href="/" aria-label="Inicio">Tu Empresa</a>
      <button id="nav-toggle" class="nav-toggle" aria-label="Abrir menú" aria-controls="mobile-drawer" aria-expanded="false">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>
      <nav class="nav-desktop" aria-label="Menú principal">
        <a href="#servicios">Servicios</a>
        <a href="/stock.html">Stock</a>
        <a href="#contacto" class="btn primary">Contacto</a>
      </nav>
    </div>

    <!-- Drawer -->
    <div id="mobile-drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Menú">
      <div class="drawer-inner">
        <div class="drawer-top">
          <span class="drawer-title">Menú</span>
          <button class="drawer-close" aria-label="Cerrar menú">✕</button>
        </div>
        <nav class="drawer-nav">
          <a href="#servicios" class="drawer-link">Servicios</a>
          <a href="/stock.html" class="drawer-link">Stock</a>
          <a href="#contacto" class="drawer-link btn primary" style="text-align:center;">Contacto</a>
        </nav>
        <div style="height:calc(12px + env(safe-area-inset-bottom,0px))"></div>
      </div>
      <button class="drawer-backdrop" tabindex="-1" aria-hidden="true"></button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" role="region" aria-label="Presentación principal">
    <div>
      <h1>Importación y Exportación de Coches Premium</h1>
      <p>Encuentra el coche que buscas desde Europa o EE.UU. Nos encargamos de transporte, aduanas, matriculación y garantía.</p>
      <a href="#contacto" class="btn primary">Solicitar información</a>
    </div>
    <div>
      <img src="https://picsum.photos/seed/coche1/800/500" alt="Ejemplo de coche premium importado" loading="lazy" decoding="async" width="800" height="500">
    </div>
  </section>

  <!-- SERVICIOS -->
  <section id="servicios" aria-labelledby="servicios-title">
    <h2 id="servicios-title">Servicios</h2>
    <div class="grid">
      <article class="card"><h3 style="margin-top:0;color:#fff">Búsqueda a medida</h3><p>Encontramos el coche que quieres con historial verificado.</p></article>
      <article class="card"><h3 style="margin-top:0;color:#fff">Transporte y aduanas</h3><p>Gestión logística completa hasta tu puerta.</p></article>
      <article class="card"><h3 style="margin-top:0;color:#fff">Matriculación</h3><p>Nos encargamos de ITV y papeles en España.</p></article>
    </div>
  </section>

  <!-- STOCK -->
  <section id="stock" aria-labelledby="stock-title">
    <h2 id="stock-title">Coches disponibles</h2>
    <div class="grid" id="stock-grid" role="list"></div>
    <div style="text-align:center; margin-top:12px">
      <a class="btn primary" href="/stock.html">Ver todo el stock</a>
    </div>
  </section>

  <!-- CONTACTO -->
  <section id="contacto" aria-labelledby="contacto-title">
    <h2 id="contacto-title">Contacto</h2>
    <form id="contact-form" aria-label="Formulario de contacto" novalidate>
      <label for="nombre">Nombre</label>
      <input type="text" id="nombre" name="nombre" placeholder="Nombre" required minlength="2" maxlength="100">
      <label for="email">Email</label>
      <input type="email" id="email" name="email" placeholder="Email" required maxlength="254">
      <label for="telefono">Teléfono (opcional)</label>
      <input type="tel" id="telefono" name="telefono" placeholder="Teléfono (opcional)" pattern="^[0-9 +()\\-]{7,}$">
      <label for="mensaje">Mensaje</label>
      <textarea id="mensaje" name="mensaje" placeholder="Mensaje" required minlength="10" maxlength="2000"></textarea>

      <!-- hidden -->
      <input type="hidden" name="car_id" id="car_id">
      <input type="hidden" name="coche_interes" id="coche_interes">
      <input type="text" name="company" autocomplete="off" tabindex="-1" style="position:absolute; left:-10000px;">

      <button type="submit" id="submit-btn">Enviar</button>
      <p id="form-status" aria-live="polite" style="margin-top:12px;text-align:center;"></p>
    </form>
  </section>

  <!-- FOOTER -->
  <footer>
    © 2025 Tu Empresa · Importación y Exportación de Coches
  </footer>

  <!-- FAB móvil -->
  <div class="fab" aria-label="Acciones rápidas">
    <a href="#contacto" aria-label="Ir a contacto">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8z" stroke-linejoin="round" stroke-linecap="round"/></svg>
      Contacto
    </a>
    <a class="secondary" href="https://wa.me/34600000000?text=Hola%2C%20quiero%20informaci%C3%B3n%20sobre%20coches%20premium" target="_blank" rel="noopener" aria-label="Abrir WhatsApp">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.52 3.48A11.86 11.86 0 0 0 12.02 0C5.4.02.03 5.38 0 12a11.9 11.9 0 0 0 1.62 6L0 24l6.17-1.62A11.96 11.96 0 0 0 12 24h.01C18.63 24 24 18.64 24 12.02c0-3.18-1.24-6.18-3.48-8.54ZM12 22a9.9 9.9 0 0 1-5.05-1.39l-.36-.21-3.66.96.98-3.56-.23-.37A10 10 0 1 1 12 22Zm5.54-7.46c-.3-.15-1.77-.87-2.05-.97-.28-.1-.48-.15-.68.15-.2.3-.78.97-.95 1.17-.17.2-.35.22-.65.07-1.77-.88-2.93-1.57-4.09-3.57-.31-.53.31-.49.88-1.63.1-.2.05-.37-.03-.52-.08-.15-.68-1.63-.93-2.23-.24-.58-.5-.5-.68-.5-.17 0-.37-.02-.57-.02s-.52.07-.79.37c-.27.3-1.04 1.02-1.04 2.48s1.07 2.88 1.22 3.08c.15.2 2.1 3.2 5.07 4.49.71.31 1.27.5 1.7.64.71.22 1.36.19 1.88.12.57-.08 1.77-.72 2.02-1.41.25-.69.25-1.28.17-1.41-.07-.13-.27-.2-.57-.35Z"/></svg>
      WhatsApp
    </a>
  </div>

  <!-- App: Stock + Lead -->
  <script>
  (function(){
    const BASE = 'https://qsinlewdrvohrpkaxjxg.supabase.co/rest/v1';
    const ANON = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFzaW5sZXdkcnZvaHJwa2F4anhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyNDgzNDMsImV4cCI6MjA3MTgyNDM0M30.Zi-7odAn1LLZqw6YxyINRO4QLcjqsNhwc1TgOLQ3jQw';

    const grid = document.getElementById('stock-grid');
    const FALLBACK = 'https://picsum.photos/seed/car/1000/700';

    function coverOf(rec){
      if (rec.cover) return rec.cover;
      if (Array.isArray(rec.imagenes) && rec.imagenes.length) return rec.imagenes[0];
      if (typeof rec.imagenes === 'string') {
        const m = rec.imagenes.match(/^{"?(.+?)"?}$/);
        return m ? m[1] : rec.imagenes;
      }
      return null;
    }
    const sanitizeHTML = s => (s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

    async function fetchJSON(url){
      const res = await fetch(url, { headers:{ apikey: ANON, Authorization: `Bearer ${ANON}` }});
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      return res.json();
    }

    async function fetchCars(){
      const selView = 'id,marca,modelo,version,anio,km,combustible,caja,cover,precio_objetivo,created_at,estado_publicacion';
      const urlView = `${BASE}/cars_with_cover`
        + `?select=${encodeURIComponent(selView)}`
        + `&order=created_at.desc&limit=12`
        + `&or=${encodeURIComponent('(estado_publicacion.eq.publicado,estado_publicacion.eq.disponible,estado_publicacion.is.null)')}`;

      try {
        const data = await fetchJSON(urlView);
        if (Array.isArray(data) && data.length) return data;
        console.warn("[HOME] 'cars_with_cover' vacío, paso a 'cars'.");
      } catch(e){
        console.warn("[HOME] view falló, paso a 'cars':", e.message);
      }

      const sel = 'id,marca,modelo,version,anio,km,combustible,caja,imagenes,precio_objetivo,created_at,estado_publicacion';
      const url = `${BASE}/cars?select=${encodeURIComponent(sel)}&order=created_at.desc&limit=12`;
      return fetchJSON(url);
    }

    function render(cars){
      grid.innerHTML = cars.map(c => {
        const titulo = `${c.marca ?? ''} ${c.modelo ?? ''} ${c.anio ?? ''}`.trim();
        const img    = coverOf(c) || FALLBACK;
        const km     = c.km != null ? `${Number(c.km).toLocaleString('es-ES')} km · ` : '';
        const sub    = `${km}${c.combustible ?? '-'} · ${c.caja ?? '-'}`;
        const price  = c.precio_objetivo != null ? `${Number(c.precio_objetivo).toLocaleString('es-ES')} €` : 'Bajo pedido';
        return `
          <article class="card" role="listitem">
            <a href="car.html?id=${encodeURIComponent(c.id)}" aria-label="Ver ${sanitizeHTML(titulo)}">
              <img src="${img}" alt="${sanitizeHTML(titulo)}" loading="lazy" decoding="async"
                   referrerpolicy="no-referrer"
                   onerror="this.onerror=null;this.src='${FALLBACK}'">
            </a>
            <div style="padding:10px">
              <b style="color:#fff">${sanitizeHTML(titulo)}</b><br>
              <span>${sanitizeHTML(sub)}</span><br>
              <span class="tag" style="color:#E5E7EB">${sanitizeHTML(price)}</span>
            </div>
          </article>`;
      }).join('');
    }

    (async () => {
      try{
        if (!grid) return;
        grid.innerHTML = "<p style='color:var(--muted)'>Cargando coches…</p>";
        const cars = await fetchCars();
        if (!cars.length){ grid.innerHTML = "<p style='color:var(--muted)'>No hay coches publicados ahora mismo.</p>"; return; }
        render(cars);
      }catch(e){
        console.error(e);
        grid.innerHTML = "<p style='color:#FCA5A5'>Error cargando coches.</p>";
      }
    })();

    /* ===== Envío del formulario de contacto (HOME) ===== */
    const formEl = document.getElementById('contact-form');
    formEl?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(formEl);

      // Honeypot
      if ((fd.get('company') || '').toString().trim()) return;

      const payload = {
        nombre: (fd.get('nombre')||'').toString().trim(),
        email:  (fd.get('email') ||'').toString().trim(),
        telefono: (fd.get('telefono')||'').toString().trim(),
        mensaje: (fd.get('mensaje')||'').toString().trim(),
        coche_interes: (fd.get('coche_interes')||'').toString().trim() || null,
        car_id: (fd.get('car_id')||'').toString().trim() || null,
        page_url: location.href,
        user_agent: navigator.userAgent
      };

      const statusEl = document.getElementById('form-status');
      const submitBtn = document.getElementById('submit-btn');

      // Validación con utils.js
      if (!Validator.required(payload.nombre, 2)) { statusEl.textContent = 'Nombre inválido.'; return; }
      if (!Validator.email(payload.email)) { statusEl.textContent = 'Email inválido.'; return; }
      if (payload.telefono && !Validator.phone(payload.telefono)) { statusEl.textContent = 'Teléfono inválido.'; return; }
      if (!Validator.required(payload.mensaje, 10)) { statusEl.textContent = 'Mensaje demasiado corto.'; return; }

      statusEl.textContent = 'Enviando…';
      submitBtn.disabled = true;

      try {
        const res = await fetch('/api/notify-lead', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('bad_status');
        statusEl.textContent = '¡Gracias! Te contactaremos en breve.';
        formEl.reset();
        notify?.success?.('Lead enviado correctamente');
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error enviando lead.';
        notify?.error?.('No se pudo enviar el formulario');
      } finally {
        submitBtn.disabled = false;
      }
    });
  })();
  </script>

  <!-- Menú (solo X cierra) -->
  <script>
    (() => {
      const toggleBtn = document.getElementById('nav-toggle');
      const drawer    = document.getElementById('mobile-drawer');
      const closeBtn  = drawer?.querySelector('.drawer-close');
      if (!toggleBtn || !drawer) return;

      const focusableSel = ['a[href]','button:not([disabled])','input','select','textarea','[tabindex]:not([tabindex="-1"])'].join(',');
      let lastFocused = null;

      const open = () => {
        lastFocused = document.activeElement;
        drawer.classList.add('open');
        document.body.classList.add('nav-open');
        toggleBtn.setAttribute('aria-expanded','true');
        drawer.querySelector(focusableSel)?.focus({preventScroll:true});
      };
      const close = () => {
        drawer.classList.remove('open');
        document.body.classList.remove('nav-open');
        toggleBtn.setAttribute('aria-expanded','false');
        lastFocused?.focus?.({preventScroll:true});
      };
      const isOpen = () => drawer.classList.contains('open');

      toggleBtn.addEventListener('click', () => isOpen() ? close() : open(), { passive:true });
      closeBtn?.addEventListener('click', close, { passive:true });

      // Accesibilidad: trap focus + Escape
      window.addEventListener('keydown', (e) => {
        if (!isOpen()) return;
        if (e.key === 'Escape') { e.preventDefault(); close(); }
        if (e.key === 'Tab') {
          const f = [...drawer.querySelectorAll(focusableSel)];
          if (!f.length) return;
          const first = f[0], last = f[f.length-1];
          if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
          else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
        }
      });

      // Resets bfcache/iOS
      const resetDrawerState = () => { drawer.classList.remove('open'); document.body.classList.remove('nav-open'); toggleBtn.setAttribute('aria-expanded','false'); };
      window.addEventListener('pageshow', resetDrawerState);
      window.addEventListener('pagehide', resetDrawerState);
      window.addEventListener('beforeunload', resetDrawerState);
      document.addEventListener('visibilitychange', () => { if (document.hidden) resetDrawerState(); });
    })();
  </script>
</body>
</html>
