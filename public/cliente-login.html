<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Acceso — Cliente</title>
<link rel="icon" href="/favicon.ico">
<style>
  body{background:#0f172a;color:#e5e7eb;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0}
  .wrap{max-width:420px;margin:64px auto;padding:0 16px}
  .card{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:20px;box-shadow:0 8px 24px rgba(0,0,0,.25)}
  h1{margin:0 0 16px;font-size:24px}
  label{display:block;font-size:14px;margin:10px 0 6px;color:#a3a3a3}
  input{width:100%;background:#0b1220;border:1px solid #243042;border-radius:10px;padding:12px;color:#e5e7eb}
  .row{display:flex;gap:8px;margin-top:14px}
  button{flex:1;background:#6366f1;border:0;border-radius:10px;padding:12px 14px;color:#fff;font-weight:600;cursor:pointer}
  button.secondary{background:#334155}
  .msg{margin-top:12px;font-size:14px;color:#a3a3a3;min-height:20px}
</style>
<script src="/api/public-config.js"></script>
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2?bundle";
  const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.__APP_CONFIG__ || {};
  const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const form = document.querySelector("#f");
  const msg = document.querySelector("#msg");
  const toPrefs = () => location.href = "/mi-cuenta.html";

  // Si ya hay sesión → a preferencias
  sb.auth.getSession().then(({ data }) => { if (data?.session) toPrefs(); });

  document.querySelector("#login").onclick = async () => {
    msg.textContent = "Iniciando sesión…";
    const email = form.email.value.trim(); const password = form.password.value;
    const { error } = await sb.auth.signInWithPassword({ email, password });
    if (error) { msg.textContent = "Error: " + error.message; return; }
    msg.textContent = "OK. Redirigiendo…"; toPrefs();
  };

  document.querySelector("#signup").onclick = async () => {
    msg.textContent = "Creando cuenta…";
    const email = form.email.value.trim(); const password = form.password.value;
    const emailRedirectTo = `${location.origin}/auth-callback.html?from=client`;
    const { error } = await sb.auth.signUp({ email, password, options:{ emailRedirectTo }});
    msg.textContent = error ? ("Error: " + error.message) : "Cuenta creada. Revisa tu correo para confirmar.";
  };
</script>

<div class="wrap">
  <div class="card">
    <h1>Acceso (clientes)</h1>
    <form id="f" onsubmit="return false;">
      <label>Email</label>
      <input type="email" name="email" placeholder="tú@correo.com" required>
      <label>Contraseña</label>
      <input type="password" name="password" placeholder="••••••••" required>
      <div class="row">
        <button id="login">Entrar</button>
        <button id="signup" class="secondary" type="button">Crear cuenta</button>
      </div>
      <div class="msg" id="msg"></div>
    </form>
  </div>
</div>
